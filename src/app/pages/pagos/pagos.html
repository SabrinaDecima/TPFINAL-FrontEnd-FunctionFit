<div class="max-w-4xl mx-auto py-12 space-y-8">

  <!-- LOADING -->
  <div *ngIf="loading()" class="text-center text-slate-400">
    Cargando pagos...
  </div>

  <!-- PAGO ACTUAL -->

  <div *ngIf="checkingPayment()" class="text-center text-slate-500">
    Comprobando estado de pago con MercadoPago... ⏳
  </div>
  <div *ngIf="!loading() && currentPayment()"
       class="rounded-2xl p-6 shadow-lg"
       [ngClass]="currentPayment()?.Pagado ? 'bg-green-500 text-white' : 'bg-yellow-400 text-slate-900'">

    <h2 class="text-xl font-semibold mb-2">Estado de tu membresía</h2>

    <p class="text-lg">
      {{ formatDate(currentPayment()?.Fecha) }} ·
      <span class="font-bold">
        {{ currentPayment()?.Pagado ? 'Pagado' : 'Impago' }}
      </span>
    </p>

    <button *ngIf="!currentPayment()?.Pagado"
            (click)="pay()"
            class="mt-4 bg-slate-900 text-yellow-400 px-6 py-2 rounded-xl font-semibold hover:bg-slate-800 transition">
      Pagar ahora
    </button>

    <div *ngIf="!currentPayment()?.Pagado" class="mt-4 space-y-2">
      <p class="text-sm text-slate-700">Si ya fuiste redirigido por MercadoPago y no se actualizó el estado, podés pegar el <code>payment_id</code> aquí:</p>
      <div class="flex items-center gap-2">
        <input [(ngModel)]="verificationId" placeholder="Payment ID de MercadoPago" class="px-3 py-2 rounded border w-full" />
        <button (click)="verifyPaymentWithId()" class="px-4 py-2 bg-slate-700 text-white rounded">Verificar</button>
      </div>
    </div>

    <p *ngIf="currentPayment()?.Pagado" class="mt-2">
      ¡Membresía activa! Ya podés reservar clases.
    </p>
  </div>

  <!-- SIN PAGOS -->
  <div *ngIf="!loading() && !currentPayment()" class="text-center text-slate-600">
    ¡No hay pagos pendientes!
  </div>

  <!-- HISTORIAL -->
  <div *ngIf="!loading() && paymentHistory().length">
    <h3 class="text-lg font-semibold mb-4">Historial de pagos</h3>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div *ngFor="let pago of paymentHistory()"
           class="rounded-2xl p-4 border shadow-md hover:shadow-yellow-400 transition">

        <p><span class="font-semibold">Mes:</span> {{ formatDate(pago.Fecha) }}</p>
        <p><span class="font-semibold">Monto:</span> ${{ pago.Monto }}</p>
        <p>
          <span class="font-semibold">Estado:</span>
          <span [ngClass]="pago.Pagado ? 'text-green-500' : 'text-red-500'">
            {{ pago.Pagado ? 'Pagado' : 'Impago' }}
          </span>
        </p>
      </div>
    </div>
  </div>

</div>
